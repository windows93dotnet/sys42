<!DOCTYPE html>
<meta charset="utf-8" />
<title>vhost</title>

<script type="module">
  import ipc from "../../core/ipc.js"

  const bus = ipc.to(window.parent)

  ipc.on("42_DISK_INIT", () => bus.send("42_DISK_INIT"))
  ipc.on("42_VHOST_PROXY_REQ", async (url) => bus.send("42_VHOST_REQ", url))

  navigator.serviceWorker?.register("/42.sw.js?vhost", { type: "module" })
  await navigator.serviceWorker.ready

  const params = new URLSearchParams(location.search)

  const iframe = document.createElement("iframe")
  iframe.style = `
    border: 0;
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;`
  iframe.src = params.get("path")
  document.body.append(iframe)
</script>
