<!DOCTYPE html>
<meta charset="utf-8" />
<title>vhost</title>

<script type="module">
  import "./42/ui/components/dialog.js"
  import ipc from "/42/core/ipc.js"

  const bus = ipc.to(window.parent, { origin: "*" })

  ipc.on("42_REQUEST_URL", async (url) => bus.send("42_PROXY_REQUEST_URL", url))

  navigator.serviceWorker?.register("/42-vhost.sw.js", { type: "module" })
  await navigator.serviceWorker.ready

  const params = new URLSearchParams(location.search)

  const iframe = document.createElement("iframe")
  iframe.style = `
    border: 0;
    position: fixed;
    inset: 0;
    width: 100%;
    height: 100%;`
  iframe.src = params.get("path")
  document.body.append(iframe)
</script>
