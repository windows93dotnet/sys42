<!DOCTYPE html>
<meta charset="utf-8" />
<title>fields</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/style.css" id="theme" />

<script type="module">
  import trap from "../../42/fabric/type/error/trap.js"
  trap()
</script>

<script type="module">
  import ui from "../../42/ui.js"
  import http from "../../42/core/http.js"
  import stream from "../../42/core/stream.js"

  import filePicker from "../../42/ui/invocables/filePicker.js"
  import prompt from "../../42/ui/invocables/prompt.js"
  import alert from "../../42/ui/invocables/alert.js"
  import confirm from "../../42/ui/invocables/confirm.js"
  import progress from "../../42/ui/invocables/progress.js"
  import explorer from "../../42/ui/components/explorer.js"

  const err = new TypeError("boom")

  await ui({
    tag: "body.pa-xl",
    content: [
      {
        tag: "button",
        label: "Alert",
        async click() {
          console.log(await alert("Hello, alert"))
        },
      },
      {
        tag: "button",
        label: "Alert with icon",
        async click() {
          console.log(
            await alert("Hello, alert", { icon: "warning", agree: "Fine !" })
          )
        },
      },
      {
        tag: "button",
        label: "Error",
        async click() {
          console.log(await alert(err))
        },
      },
      {
        tag: "button",
        label: "Error with custom message",
        async click() {
          console.log(
            await alert(new TypeError("boom"), {
              message: "Oops",
              collapsed: false,
            })
          )
        },
      },
      "\n\n",
      "\n\n",
      {
        tag: "button",
        label: "Confirm",
        async click() {
          console.log(await confirm("Do you confirm ?"))
        },
      },
      {
        tag: "button",
        label: "Confirm with icon and cutom buttons",
        async click() {
          console.log(
            await confirm("Do you confirm ?", {
              icon: "question",
              agree: { picto: "check", content: "Yep" },
              decline: { picto: "cross", content: "Nope" },
            })
          )
        },
      },
      "\n\n",
      "\n\n",
      {
        tag: "button",
        label: "Prompt",
        async click() {
          console.log(await prompt())
        },
      },
      {
        tag: "button",
        label: "Prompt with icon",
        async click() {
          console.log(
            await prompt(
              "What is the meaning of life,\nthe universe and everything?",
              { icon: "question", value: 42 }
            )
          )
        },
      },
      {
        tag: "button",
        label: "Prompt auto textarea",
        async click() {
          console.log(await prompt({ value: "A text\nwith newlines\n..." }))
        },
      },
      "\n\n",
      "\n\n",
      {
        tag: "button",
        label: "Progress",
        async click() {
          const p = progress(100, { _icon: "error" })
          const state = await p.state
          state.value = 30
          state.description = "0/1"
        },
      },
      {
        tag: "button",
        label: "Progress as TransformStream",
        async click() {
          http
            .source("../../tests/fixtures/stream/html_standard.html.gz", {
              cors: "no-cors",
            })
            .size((total, rs) => {
              rs.pipeThrough(stream.ts.cut(10_000))
                .pipeThrough(stream.ts.pressure(100))
                .pipeThrough(progress(total, { keep: !true }))
                .pipeTo(stream.ws.sink())
                .catch(() => {
                  console.log("canceled pipeline")
                })
            })
        },
      },
      "\n\n",
      "\n\n",
      {
        tag: "button",
        label: "Explorer",
        async click() {
          console.log(await explorer())
        },
      },
      "\n\n",
      "\n\n",
      {
        tag: "button",
        label: "File Picker Open",
        async click() {
          console.log(await filePicker.open())
        },
      },
      {
        tag: "button",
        label: "File Picker Open (website/index.html)",
        async click() {
          console.log(
            await filePicker.open("/tests/fixtures/website/index.html")
          )
        },
      },
      "\n\n",
      {
        tag: "button",
        label: "File Picker Save",
        async click() {
          console.log(await filePicker.save())
        },
      },
      {
        tag: "button",
        label: 'File Picker Save with content "hello world"',
        async click() {
          console.log(await filePicker.save("/hello.txt", "hello world"))
        },
      },
    ],
  })

  // import puppet from "../../42/core/dev/puppet.js"
  // await puppet("button:nth-of-type(10)").click()

  // await puppet("button:nth-of-type(11)").click()
  // await puppet("button:nth-of-type(4)").click()
</script>
