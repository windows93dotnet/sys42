<!DOCTYPE html>
<meta charset="utf-8" />
<title>ipc.plugin</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/style.css" id="theme" />

<script type="module">
  import trap from "../../../42/fabric/type/error/trap.js"
  trap()
</script>

<script type="module">
  import ui from "../../../42/ui.js"

  const app = await ui(
    {
      tag: "body.box-fit.desktop",
      content: [
        {
          tag: "button#incr",
          content: "{{cnt}}",
          click: "{{cnt += 1}}",
        },

        {
          tag: "button#dialog",
          content: "dialog",
          dialog: {
            y: 100,
            label: "top ({{x}},{{y}})",
            content: {
              tag: "button#dialog-incr",
              content: "{{cnt}}",
              click: "{{cnt += 1}}",
            },
          },
        },

        {
          content: {
            tag: "ui-sandbox#sandbox1",
            permissions: "trusted",
            content: [
              {
                tag: "button#iframe1-incr",
                content: "{{cnt}}",
                click: "{{cnt += 1}}",
              },
              {
                tag: "button#iframe1-dialog",
                content: "dialog",
                dialog: {
                  y: 200,
                  label: "iframe ({{x}},{{y}})",
                  content: {
                    tag: "button#iframe1-dialog-incr",
                    content: "{{cnt}}",
                    click: "{{cnt += 1}}",
                  },
                },
              },
            ],
            script: `app.query("button#iframe1-dialog")?.click()`,
          },
        },

        {
          content: {
            tag: "ui-sandbox#sandbox2.ground",
            permissions: "trusted",
            content: [
              {
                tag: "button#iframe2-incr",
                content: "{{cnt}}",
                click: "{{cnt += 1}}",
              },
              {
                tag: "button#iframe2-dialog",
                content: "dialog",
                dialog: {
                  y: 300,
                  label: "iframe ({{x}},{{y}})",
                  content: {
                    tag: "button#iframe2-dialog-incr",
                    content: "{{cnt}}",
                    click: "{{cnt += 1}}",
                  },
                },
              },
            ],
            script: `app.query("button#iframe2-dialog")?.click()`,
          },
        },
      ],

      state: {
        cnt: 42,
      },
    },
    { trusted: true }
  )

  globalThis.app = app

  app.query("button#dialog")?.click()

  setTimeout(() => {
    app.query("button#incr")?.click()
  }, 1000)
</script>
