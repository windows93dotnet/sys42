<!DOCTYPE html>
<meta charset="utf-8" />
<title>persist</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/style.css" id="theme" />

<script type="module">
  import trap from "../../../42/fabric/type/error/trap.js"
  trap()
</script>

<script type="module">
  import ui from "../../../42/ui.js"
  import log from "../../../42/core/log.js"

  // import fs from "../../../42/core/fs.js"
  // import disk from "../../../42/core/disk.js"
  // await fs.deleteDir(disk.HOME + "/.ui").catch(() => {})

  const app = await ui(
    {
      tag: "body.box-fit.desktop._motionless",
      content: [
        {
          tag: "button#incr",
          content: "{{cnt}}",
          on: { click: "{{cnt += 1}}" },
        },
        {
          tag: "button#dialog-left",
          content: "dialog <--",
          dialog: {
            x: 100,
            animate: { translate: "0 -100%", opacity: 0 },
            label: "<-- ({{x}},{{y}})",
            content: {
              tag: "button#incr",
              content: "{{cnt}}",
              on: { click: "{{cnt += 1}}" },
            },
          },
        },
        {
          tag: "button#dialog-right",
          content: "dialog -->",
          dialog: {
            animate: { translate: "0 -100%", opacity: 0 },
            label: "--> ({{x}},{{y}})",
            content: {
              tag: "button#incr",
              autofocus: true,
              content: "{{cnt}}",
              on: { click: "{{cnt += 1}}" },
            },
          },
        },
        // {
        //   tag: "button#nested",
        //   content: "nested",
        //   dialog: {
        //     y: 100,
        //     animate: { translate: "0 100%", opacity: 0 },
        //     label: "nested ({{x}},{{y}})",
        //     content: {
        //       tag: "button#nested2",
        //       autofocus: true,
        //       content: "{{cnt}}",
        //       dialog: {
        //         x: 100,
        //         y: 100,
        //         animate: { translate: "0 100%", opacity: 0 },
        //         label: "nested 2 ({{x}},{{y}})",
        //         content: {
        //           tag: "button#incr",
        //           autofocus: true,
        //           content: "{{cnt}}",
        //           on: { click: "{{cnt += 1}}" },
        //         },
        //       },
        //     },
        //   },
        // },
      ],

      plugins: ["persist"],

      state: {
        cnt: 42,
      },
    },
    { id: "persist-test" }
  )

  if (app.ctx.plugins.persist.initial) {
    app.query("#incr")?.click()
    app.query("#dialog-left")?.click()
    app.query("#dialog-right")?.click()
    // app.query("#nested")?.click()
    // await app
    // app.query("#nested2")?.click()
    log(app.data)
  }

  app.on("click", () => {
    log(app.data)
  })
</script>
