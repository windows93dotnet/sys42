<!DOCTYPE html>
<meta charset="utf-8" />
<title>ui-menu</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/style.css" id="theme" />

<script type="module">
  import trap from "../../../42/fabric/type/error/trap.js"
  trap()
</script>

<script type="module">
  import "../../../42/ui/components/dialog.js"
  import "../../../42/ui/popup.js"
  import ui from "../../../42/ui.js"

  import when from "../../../42/fabric/type/promise/when.js"
  import inTop from "../../../42/core/env/realm/inTop.js"
  import puppet from "../../../42/core/dev/puppet.js"

  const content = (label) => [
    {
      label: `Dialog ${label}`,
      id: `menuItemDialog${label}`,
      picto: "folder-open",
      shortcut: "Ctrl+O",
      dialog: {
        label: `Dialog ${label}`,
        content: [
          {
            tag: "number",
            scope: "cnt",
            compact: true,
          },
          {
            tag: "button",
            content: "{{cnt}}++",
            click: "{{cnt++}}",
          },
        ],
      },
    },
    {
      label: "Disabled",
      picto: "save",
      shortcut: "Ctrl+S",
      click: "{{save()}}",
      disabled: true,
    },
    "---",
    { label: "Incr {{cnt}}", click: "{{cnt = incr(cnt)}}" },
  ]

  const demo = {
    tag: ".pa-xxl",
    content: [
      { tag: "number", scope: "cnt", compact: true },
      "\n\n",
      "\n\n",
      {
        tag: "button.w-ctrl",
        content: "{{cnt}}++",
        click: "{{cnt++}}",
      },
      "---",
      { tag: "ui-menu", content: content("Inline") },
      "---",
      { tag: "button#btnMenu", content: "Menu", menu: content("Popup") },
    ],

    state: {
      cnt: 42,
    },

    actions: {
      open() {
        console.log("open", inTop)
      },
      save() {
        console.log("save", inTop)
      },
      incr(n) {
        return n + 1
      },
    },
  }

  let app

  if (inTop) {
    app = await ui(
      {
        tag: ".box-fit.desktop",
        content: {
          tag: ".box-v.w-full",
          content: [
            demo,
            // {
            //   tag: "ui-sandbox.panel",
            //   permissions: "trusted",
            //   path: "./menu.demo.html",
            // },
          ],
        },
      },
      { trusted: true }
    )

    puppet.aim("#btnMenu").click()
    await when("uipopupopen")
    puppet.aim("#menuItemDialogPopup").click()
    // puppet.aim("#menuItemDialogInline").click()
    await when("uidialogopen")

    puppet.aim(".ui-dialog__body input").input(5)

    // console.log(bot)

    // const el = puppet.aim(".ui-dialog__body input")

    // puppet.aim(".ui-dialog__body input").value = 5

    // listen({
    //   uipopupopen() {
    //     puppet.aim("#menuItemDialog").click()
    //   },
    // })
    // app.query("#btnDialog").click()
  } else {
    app = await ui(demo)
    // app.query("#btnMenu").click()
    // app.query("#btnDialog").click()
  }
</script>
