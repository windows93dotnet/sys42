<!DOCTYPE html>
<meta charset="utf-8" />
<title>popup</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/style.css" id="theme" />

<script type="module">
  import trap from "../../42/fabric/type/error/trap.js"
  trap()
</script>

<script type="module">
  import ui from "../../42/ui.js"

  const button = (label) => ({
    tag: `button#btnIncr${label}`,
    content: "{{cnt}}",
    click: "{{cnt += 1}}",
  })

  const buttons = (label) => ({
    tag: ".box-h",
    content: [
      button(label),
      {
        tag: `button#btnDialog${label}`,
        content: "dialog",
        dialog: {
          x:
            label === "Top"
              ? window.innerWidth / 2 - 200
              : window.innerWidth / 2 + 50,
          label,
          content: button(`Dialog${label}`),
        },
      },
      {
        tag: `button#btnPopup${label}`,
        content: "popup",
        popup: {
          tag: ".panel.outset.pa-lg",
          content: [`hello from ${label}`, "\n\n", button(label)],
        },
      },
    ],
  })

  const app = await ui(
    {
      tag: ".box-fit.box-center",
      content: {
        tag: ".box-v.w-full",
        content: [
          {
            tag: ".box-center.ground",
            content: buttons("Top"),
          },
          {
            tag: "ui-sandbox",
            permissions: "app",
            content: {
              tag: ".box-fit.box-center.desktop",
              content: buttons("Iframe"),
            },
            script: `
            app.query("#btnDialogIframe").click()
            app.query("#btnPopupIframe").click()
            `,
          },
          {
            tag: "iframe.document",
            srcdoc: 'iframe without xlisten <input type="checkbox"/>',
          },
        ],
      },
      state: {
        cnt: 42,
      },
    },
    { id: "popup-demo", trusted: true }
  )

  app.query("#btnDialogTop").click()
  setTimeout(() => app.query("#btnIncrIframe").click(), 500)
</script>
