<!DOCTYPE html>
<meta charset="utf-8" />
<title>desktop</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/style.css" id="theme" />

<script type="module">
  import trap from "../42/fabric/type/error/trap.js"
  trap()
</script>

<script type="module">
  import os from "../42/os.js"
  import ui from "../42/ui.js"

  import disk from "../42/core/disk.js"

  import trap from "../42/fabric/type/error/trap.js"
  trap((err) => {
    os.desktop.state.errors.push(err)
  })

  document.body.classList.add("desktop")

  os.desktop = await ui({
    tag: "body.box-fit.box-v._debug",
    content: [
      {
        scope: "desktop",
        tag: "main#desktop.desktop",
        content: [
          {
            tag: "ui-folder.box-fit.scroll-auto",
            // path: "$HOME/desktop/",
            path: "/tests/fixtures/formats/",
            transferable: {
              accept: { kind: ["$file", "$app"] },
              import({ kind }) {
                console.log("desktop import", ...kind)
                // return "revert"
              },
            },
          },
        ],
      },
      {
        scope: "taskbar",
        tag: "footer#taskbar.d-flex.outset.pa-xs",
        content: [
          {
            tag: "button",
            content: "Start",
            picto: "puzzle",
            menu: [
              ...(await os.apps.makeMenu()),
              "---",
              {
                label: "Format",
                async click() {
                  await disk.format()
                  location.reload()
                },
              },
            ],
          },
          {
            if: "{{/errors.length > 0}}",
            tag: ".solid.error.ma-l-auto",
            content: "{{/errors.length}} error(s)",
          },
        ],
      },
    ],

    state: {
      errors: [],
    },
  })

  // import io from "../42/io.js"
  // io.launchFolders("/tests/fixtures/formats/video/")
  // io.launchFiles("/tests/fixtures/formats/video/example.mp4")
  // io.launchFiles("/tests/fixtures/formats/example.html")
  // io.launchFiles("/tests/fixtures/formats/video/example.mp4")
  // io.launchFiles("/tests/fixtures/formats/image/example.jpg")
  // io.launchFiles([
  //   "/tests/fixtures/formats/example.json",
  //   "/tests/fixtures/formats/example.json5",
  // ])

  // import "../tests/apps/Hydra/Hydra.js"

  import appsManager from "../42/os/managers/appsManager.js"
  appsManager.exec("PixelEdit")

  // import appsManager from "../42/os/managers/appsManager.js"
  // appsManager.exec("Hydra")

  // import appsManager from "../42/os/managers/appsManager.js"
  // appsManager.exec("TextEdit")

  // import appsManager from "../42/os/managers/appsManager.js"
  // appsManager.exec("TextEdit", {
  //   $files: [
  //     "/tests/fixtures/formats/example.json5",
  //     "/tests/fixtures/formats/example.html",
  //     "/style.css",
  //   ],
  // })
</script>
