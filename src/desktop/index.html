<!DOCTYPE html>
<meta charset="utf-8" />
<title>desktop</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/style.css" id="theme" />

<script type="module">
  import trap from "../42/fabric/type/error/trap.js"
  trap()
</script>

<script type="module">
  import ui from "../42/ui.js"
  import explorer from "../42/ui/components/explorer.js"
  import open from "../42/os/cmd/open.cmd.js"
  import dialog from "../42/ui/components/dialog.js"

  const app = await ui({
    tag: "body.box-fit.box-h._debug",
    content: [
      {
        tag: "main#desktop.desktop",
        content: [
          {
            tag: "ui-folder.box-fit.scroll-auto",
            on: [
              {
                selector: 'ui-icon[aria-description="folder"]',
                dblclick: "{{openFolder(target.path)}}",
              },
              {
                selector: 'ui-icon[aria-description="file"]',
                dblclick: "{{openFile(target.path)}}",
              },
            ],
          },
          // {
          //   tag: "ui-dialog",
          //   content: {
          //     tag: "ui-sandbox",
          //     // permissions: "web",
          //     // path: "https://zombect.ro",
          //     permissions: "app",
          //     path: "../demos/ui/fields.demo.html",
          //   },
          // },
        ],
      },
      {
        scope: "taskbar",
        tag: "footer#taskbar.outset.pa-xs",
        content: {
          tag: "button",
          label: "Start",
          picto: "puzzle",
          on: { click: "{{start(e, target)}}" },
        },
      },
    ],

    actions: {
      openFolder(path) {
        explorer(path)
      },
      openFile(path) {
        open(path)
      },
      taskbar: {
        start(e, target) {
          console.log("start", e, target)
        },
      },
    },
  })

  dialog({
    // style: { width: 100, height: 100 },
    label: "ok",
    content: "hello",
    // content: {
    //   tag: "ui-sandbox.inset.document",
    //   zoom: 0.6,
    //   permissions: "app",
    //   path: "../tests/fixtures/formats/image/example.svg",
    // },
  })

  globalThis.app = app

  // app
  //   .query('ui-icon[path="/files.json"]')
  //   ?.dispatchEvent(new CustomEvent("dblclick", { bubbles: true }))

  // if (globalThis.top === globalThis) {
  //   open("/desktop/index.html")
  // } else {
  //   app
  //     .query('ui-icon[path="/style.css"]')
  //     ?.dispatchEvent(new CustomEvent("dblclick", { bubbles: true }))
  // }
</script>
