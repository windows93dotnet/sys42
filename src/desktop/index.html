<!DOCTYPE html>
<meta charset="utf-8" />
<title>desktop</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/style.css" id="theme" />

<script type="module">
  import ui from "../42/ui.js"
  import dirname from "../42/fabric/type/path/extract/dirname.js"

  const explorer = {
    // scope: "explorer",
    type: ".box-h.pa-xs.outset",
    style: { width: "300px", height: "300px" },
    content: [
      {
        type: "header.box-v.ctrl-group.mb-xs",
        content: [
          {
            type: "button",
            picto: "arrow-up",
            run: "folderUp",
          },
          {
            type: "input",
            name: "path",
            bind: "change",
            compact: true,
            prose: false,
            enterkeyhint: "go",
          },
        ],
      },
      {
        type: "ui-folderview.inset",
        path: "{{path}}",
      },
    ],

    // shortcuts: [
    //   {
    //     key: "[dblclick]",
    //     // key: "[click]",
    //     selector: "ui-icon",
    //     run: "changePath",
    //     args: ["target.path"],
    //   },
    // ],

    actions: {
      changePath(path) {
        this.path = path
      },
      folderUp() {
        let newPath = dirname(this.path)
        if (!newPath.endsWith("/")) newPath += "/"
        this.path = newPath
      },
    },

    data: {
      // path: "/42/",
      path: "/",
    },
  }

  // window.app = await ui(explorer)

  window.app = ui.trusted({
    type: "body.box-center.desktop",
    content: {
      type: "div",
      label: "Folder View",
      style: { width: "300px" },
      content: [
        "The path textfield supports [https://en.wikipedia.org/wiki/Glob_(programming)](glob patterns).",
        "A wildcard (*) is added automatically at the end of the path. Try typing first letters of any file/folder",
        explorer,
        // {
        //   type: ".box-h.pa-xs.outset.mt",
        //   style: { width: "300px", height: "50px" },
        //   content: [
        //     // {
        //     //   type: "iframe",
        //     //   src: "/42/os/apps/TextEdit/index.html",
        //     // },
        //     {
        //       type: "ui-enclose",
        //       // permissions: ["scripts", "same-origin"],
        //       // permissions: false,
        //       // permissions: "trusted",
        //       permissions: "app",
        //       check: false,
        //       src: "/42/os/apps/TextEdit/index.html",
        //     },
        //   ],
        // },
      ],
    },

    // data: {
    //   explorer: {
    //     path: "/42/",
    //   },
    // },

    // actions: {
    //   changePath(e, target) {
    //     this.data.path = target.path
    //   },
    //   folderUp(e, target) {
    //     let newPath = dirname(this.data.path)
    //     if (!newPath.endsWith("/")) newPath += "/"
    //     this.data.path = newPath
    //   },
    // },

    // data: {
    //   path: "/42/",
    // },
  })

  // setTimeout(() => {
  //   window.app.get("ui-icon").click()
  // }, 600)

  // import a11y from "../../42/a11y.js"

  // setTimeout(() => {
  //   a11y.tree()
  // }, 1000)
</script>
