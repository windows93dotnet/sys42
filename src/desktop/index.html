<!DOCTYPE html>
<meta charset="utf-8" />
<title>desktop</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="stylesheet" href="/style.css" id="theme" />

<script type="module">
  import trap from "../42/fabric/type/error/trap.js"
  trap((err) => {
    import("../42/system/log.js").then((m) => m.default(err))
    return false
  })
</script>

<script type="_module">
  import log from "../42/system/log.js"

  import http from "../42/fabric/http.js"
  http("https://google.com").catch(log)

  // Promise.any([
  //   Promise.reject(new Error("some error")),
  //   Promise.reject(new Error("BOOM")),
  // ]).catch((err) => {
  //   log(err)
  // })
</script>

<script type="_module">
  import ui from "../42/ui.js"

  await ui({
    tag: ".box-fit.desktop",

    content: [
      {
        tag: "ui-picto",
        value: "{{foo}}",
      },
    ],

    on: {
      click() {
        this.state.foo = "home"
      },
    },

    state: {
      foo: "puzzle",
    },
  })
</script>

<script type="_module">
  import ui from "../42/ui.js"

  await ui({
    class: "box-fit desktop",
    content: [
      {
        tag: "ui-picto",
        value: "{{foo}}",
      },
    ],

    state: {
      foo: "puzzle",
    },
  })
</script>

<script type="_module">
  import ui from "../42/ui.js"

  const app = await ui({
    class: "box-fit desktop",
    content: [
      {
        tag: "button#incr",
        content: "{{cnt}}",
        on: { click: "{{cnt += 1}}" },
      },
      {
        tag: "button#dialog",
        content: "dialog",
        dialog: {
          label: "iframe ({{x}},{{y}})",
          content: "hello {{cnt}}",
        },
      },
    ],

    plugins: ["persist"],

    state: {
      cnt: 42,
    },
  })

  app.query("#dialog")?.click()
</script>

<script type="module">
  /* eslint-disable no-unused-vars */
  import ui from "../42/ui.js"

  const app = await ui({
    class: "box-fit desktop",
    content: [
      {
        tag: "button#incr",
        content: "{{cnt}}",
        on: { click: "{{cnt += 1}}" },
      },
      {
        content: {
          tag: "ui-sandbox",
          permissions: "app",
          content: [
            {
              tag: "button#incr",
              content: "{{cnt}}",
              on: { click: "{{cnt += 1}}" },
            },
            {
              tag: "button#dialog",
              content: "dialog",
              dialog: {
                label: "iframe ({{x}},{{y}})",
                content: {
                  tag: "button#dialog-incr",
                  content: "{{cnt}}",
                  on: { click: "{{cnt += 1}}" },
                },
              },
            },
          ],
          script: `
          app.query("#dialog")?.click()
          // setTimeout(() => app.query("#incr")?.click(), 800)
          `,
        },
      },
    ],

    state: {
      cnt: 42,
    },
  })

  // app.query("#incr").click()
  // setTimeout(() => app.query("#incr")?.click(), 500)
  setTimeout(() => {
    document.querySelector("#dialog-incr")?.click()
  }, 500)
</script>

<script type="_module">
  import ui from "../42/ui.js"

  const app = await ui({
    class: "box-fit desktop",
    content: [
      {
        tag: "button#incr",
        content: "{{cnt}}",
        on: { click: "{{cnt += 1}}" },
      },
      {
        tag: "button#dialog",
        content: "dialog",
        dialog: {
          x: 100,
          label: "top ({{x}},{{y}})",
          content: {
            tag: "button",
            content: "{{cnt}}",
            on: { click: "{{cnt += 1}}" },
          },
        },
      },
      {
        content: {
          tag: "ui-sandbox",
          permissions: "app",
          content: [
            {
              tag: "button#incr",
              content: "{{cnt}}",
              on: { click: "{{cnt += 1}}" },
            },
            {
              tag: "button#dialog",
              content: "dialog",
              dialog: {
                label: "iframe ({{x}},{{y}})",
                content: {
                  tag: "button",
                  content: "{{cnt}}",
                  on: { click: "{{cnt += 1}}" },
                },
              },
            },
          ],
          script: `
  app.query("#dialog")?.click()
  await app
  setTimeout(() => app.query("#incr")?.click(), 500)
              `,
        },
      },
    ],

    state: {
      cnt: 42,
    },
  })

  window.app = app

  app.query("#dialog")?.click()
  await app
  setTimeout(() => app.query("#incr")?.click(), 500)
</script>

<script type="_module">
  import exec from "../42/os/exec.js"
  console.log(1, await exec("glob **/*.css"))
</script>

<script type="_module">
    import "../42/os/exec.js"
    import ui from "../42/ui.js"

    await ui({
      class: "box-fit desktop",
      content: [
        {
          content: {
            tag: "ui-sandbox",
            permissions: "app",
            script: `
  import exec from "../42/os/exec.js"
  console.log(2, await exec("glob **/*.html"))
                  `,
          },
        },
      ],
    })
</script>

<script type="_module">
  import animate from "../42/fabric/dom/animate.js"
  import render from "../42/ui/render.js"
  import sleep from "../42/fabric/type/promise/sleep.js"

  const el = render({ tag: "div.bd.box-ratio.pa-xl", content: "hello" })

  document.body.className = "pa-xxl"

  await sleep(100)
  document.body.append(el)
  await animate.from(el, { rotate: "360deg", scale: "0" })
  await sleep(1000)
  await animate.to(
    el,
    { transform: "rotate(360deg) scale(0)" },
    { easing: "ease-in" }
  )
  el.remove()
</script>

<script type="_module">
    import ui from "../42/ui.js"

    const app = await ui({
      class: "box-fit desktop",
      content: [
        {
          tag: "button",
          content: "{{cnt}}",
          on: { click: "{{cnt += 1}}" },
        },
        {
          content: {
            tag: "ui-sandbox",
            check: true,
            permissions: "app",
            html: `\
  <script type="module">
  import dialog from "../42/ui/components/dialog.js"
  dialog({ content: "hello", label: "title" })
  <\/script>`,
          },
        },
      ],

      state: {
        cnt: 42,
      },
    })

    window.app = app
</script>

<script type="_module">
  import ui from "../42/ui.js"

  const app = await ui({
    class: "box-fit desktop",
    content: [
      {
        tag: "button",
        content: "{{cnt}}",
        on: { click: "{{cnt += 1}}" },
      },
      {
        content: {
          tag: "ui-sandbox",
          check: true,
          permissions: "app",
          script: `console.log("hello {{cnt}}")`,
        },
      },
    ],

    state: {
      cnt: 42,
    },
  })

  window.app = app

  import log from "../42/system/log.js"
  log(app.state)
</script>

<script type="_module">
  import ui from "../42/ui.js"

  const app = await ui({
    class: "box-fit desktop",
    content: [
      {
        tag: "button",
        content: "{{foo.cnt}}",
        on: { click: "{{foo.cnt += 1}}" },
      },
      {
        tag: "ui-dialog",
        label: "title: {{foo.cnt}} ({{x}}, {{y}})",
        content: {
          tag: "strong",
          content: "top: {{foo.cnt}}\n ({{x}}, {{y}})",
        },
      },
    ],

    state: {
      "foo": {
        cnt: 42,
      },
      "ui-dialog": {
        0: {
          active: true,
          x: 416,
          y: 208,
        },
      },
    },
  })

  window.app = app

  import log from "../42/system/log.js"
  log(app.state)
</script>

<script type="_module">
  import ui from "../42/ui.js"

  const app = await ui({
    class: "box-fit desktop",
    content: [
      {
        tag: "button",
        content: "{{foo.cnt}}",
        on: { click: "{{foo.cnt += 1}}" },
      },
      {
        tag: "ui-dialog",
        label: "title: {{foo.cnt}} ({{x}}, {{y}})",
        content: {
          tag: "strong",
          content: "top: {{foo.cnt}}\n ({{x}}, {{y}})",
        },
      },
    ],

    state: {
      "foo": {
        cnt: 42,
      },
      "ui-dialog": {
        0: {
          active: true,
          x: 416,
          y: 208,
        },
      },
    },
  })

  window.app = app

  import log from "../42/system/log.js"
  log(app.state)
</script>

<script type="_module">
  import ui from "../42/ui.js"

  const app = await ui({
    class: "box-fit desktop",
    content: [
      {
        tag: "button",
        picto: "puzzle",
      },
      {
        tag: "button",
        content: "{{foo.cnt}}",
        on: { click: "{{foo.cnt += 1}}" },
      },
      {
        scope: "foo",
        content: {
          tag: "ui-sandbox.bd.ma",
          check: true,
          permissions: "app",
          content: [
            {
              tag: "button",
              content: "sandbox: {{cnt}}",
              on: { click: "{{cnt += 1}}" },
            },
            {
              tag: "ui-dialog",
              content: { tag: "strong", content: "iframe: {{cnt}}" },
            },
            {
              tag: "ui-dialog",
              content: { tag: "strong", content: "iframe: {{cnt}}" },
            },
          ],
        },
      },
      {
        tag: "ui-dialog",
        label: "title: {{foo.cnt}} ({{x}}, {{y}})",
        content: {
          tag: "strong",
          content: "top: {{foo.cnt}}\n ({{x}}, {{y}})",
        },
      },
    ],

    state: {
      "foo": {
        cnt: 42,
      },
      "ui-dialog": {
        0: {
          active: true,
          x: 416,
          y: 208,
        },
      },
    },
  })

  window.app = app

  import log from "../42/system/log.js"
  log(app.state)
</script>

<script type="_module">
  import ui from "../42/ui.js"

  const app = await ui({
    style: {
      width: "50vw",
      transform: "scale(2)",
      transformOrigin: "top left",
    },
    content: [
      {
        tag: "button",
        content: "{{foo.cnt}}",
        on: { click: "{{foo.cnt += 1}}" },
      },
      {
        scope: "foo",
        content: {
          tag: "ui-sandbox.bd.ma",
          check: true,
          permissions: "app",
          content: {
            tag: "button",
            content: "sandbox: {{cnt}}",
            on: { click: "{{cnt += 1}}" },
          },
        },
      },
    ],

    state: {
      foo: {
        cnt: 42,
      },
    },
  })

  setTimeout(() => {
    app.query("ui-sandbox").go("/tests/fixtures/components/sandbox/script.html")
  }, 1000)
</script>

<script type="_module">
  import ui from "../42/ui.js"
  const app = await ui({
    tag: "ui-sandbox",
    check: true,
    permissions: "app",
    src: "/tests/fixtures/components/sandbox/hello.html",
    zoom: 1,
  })

  setTimeout(() => {
    app.query("ui-sandbox").go("/tests/fixtures/components/sandbox/script.html")
  }, 300)
</script>

<script type="_module">
  import ui from "../42/ui.js"
  const app = await ui({
    tag: "ui-folder",
    path: "/42/fabric/",
    selection: ["/42/fabric/mainloop.js"],
  })

  setTimeout(() => {
    // console.clear()
    const el = app.query("ui-folder")
    el.path = "/"
    el.selection.push("/42.sw.js")
  }, 300)
</script>

<script type="_module">
  import explorer from "../42/ui/components/explorer.js"
  explorer()
</script>

<script type="_module">
  import "../42/os.js"
  import open from "../42/os/cmd/open.cmd.js"
  open(["/index.html", "/42/test.js"])
</script>

<script type="_module">
  import "../42/os.js"
  import "../42/ui/components/enclose.js"
  import ui from "../42/ui.js"
  import explorer from "../42/ui/components/explorer.js"
  import open from "../42/os/cmd/open.cmd.js"

  // navigator.serviceWorker?.register("/42.sw.js", { type: "module" })

  window.app = await ui.trusted({
    type: "body.box-fit.box-h._debug",
    content: [
      {
        type: "main#desktop.desktop",
        content: [
          {
            type: "ui-folder.scroll-auto",
            // path: "/tests/fixtures/formats/",
            shortcuts: [
              {
                key: "[dblclick]",
                selector: 'ui-icon[aria-description="folder"]',
                run: "openFolder",
                args: ["target.path"],
              },
              {
                key: "[dblclick]",
                selector: 'ui-icon[aria-description="file"]',
                run: "openFile",
                args: ["target.path"],
              },
            ],
          },
          // { type: "ui-workspaces" },
        ],
      },
      // {
      //   type: "ui-tabs",
      //   // scope: "openedFiles",
      //   // state: [{ path: "ok" }],
      //   state: {
      //     currentTab: 0,
      //     openedFiles: [],
      //   },

      //   label: "{{path|basename}}{{dirty ? '*' : ''}}",
      //   content: {
      //     type: "textarea.w-full",
      //     name: "text",
      //     label: "{{openedFiles|at(currentTab)|locate('path')}}",
      //     value: "{{openedFiles|at(currentTab)|locate('file')|text}}",
      //     class: "{{monospace ? 'font-mono' : ''}}",
      //     spellcheck: "{{spellcheck}}",
      //     wrap: "{{wrap ? 'soft' : 'off'}}",
      //     prose: false,
      //     compact: true,
      //     autofocus: true,
      //   },
      // },
      // {
      //   type: "ui-sandbox.pa-xxl.bd.desktop",
      //   permissions: "app",
      //   // permissions: "trusted",
      //   // permissions: ["scripts"],
      //   check: false,
      //   // src: "../demos/ui/components/menu.demo.html",
      //   // src: "../demos/ui/components/dialog.demo.html",
      //   src: "../42/os/apps/TextEdit/index.html",
      //   // src: "../demos/os/exec.demo.html",
      //   // src: "../demos/ui/traits/selectable.demo.html",
      // },
      {
        type: "footer#taskbar.outset.pa-xs",
        scope: "desktop",
        content: {
          type: "button",
          label: "Start",
          picto: "puzzle",
          popup: {
            picto: false,
            type: "ui-menu",
            content: [{ label: "Test" }],
          },
        },
      },
    ],

    actions: {
      openFolder(path) {
        explorer(path)
      },
      openFile(path) {
        open(path)
      },
    },
  })

  // open("/home/anonymous/theme.cbor")
  open(["/index.html", "/42/test.js", "/42/ui.js"])
  // explorer("/42/")
  // explorer("/home/anonymous/")

  // explorer("/42/", { selection: ["/42/ui.js", "/42/test.js"] })
  // explorer("/42/../ui.js")
  // explorer("/42/../style.css")
  // explorer("/42/fabric/../ui.js")
</script>
